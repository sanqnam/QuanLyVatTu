<div class="row" style="border-bottom: 2px solid blue; margin-bottom: 20px;">
    <div class="pagetitle col-lg-3 col-md-3">
        <h1>Phiếu Cấp Vật Tư</h1>
        <nav>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li class="breadcrumb-item">Phiếu</li>
                <li class="breadcrumb-item active">Phiếu cấp vật tư</li>
            </ol>
        </nav>
    </div>
    <div class="col-lg-2 col-md-2">
        <form [formGroup]="filterForm">
            <div class="row">
                <div class="col-7" style="float: left;">
                    <select class="form-select" name="size" formControlName="size" (change)="filterSelect()"
                        [(ngModel)]="tableSize">
                        <ng-container *ngFor="let size of tableSizes">
                            <option [selected]="size == tableSize" [value]="size">{{size}}</option>
                        </ng-container>
                    </select>
                </div>
            </div>
        </form>
    </div>
    <div class="col-lg-7 col-md-7">

    </div>
</div>


    <div class="accordion accordion-flush " id="mainAccordion">
        <table class="table table-hover">
            <thead>
                <tr style="line-height: 36px;">
                    <th scope="col">#</th>
                    <th scope="col">Họ và tên</th>
                    <th scope="col">Tên phòng ban</th>
                    <th scope="col">Tình trạng phiếu</th>
                </tr>
            </thead>
            <tbody>
                <ng-container
                    *ngFor="let phieu of dsPhieu | paginate : { itemsPerPage: tableSize, currentPage: pg, totalItems: count }; let i = index">
                    <tr data-bs-toggle="collapse" [attr.data-bs-target]="'#faq' + i" (click)="chiTiet(phieu.idPhieuDeNghi)"
                        style="line-height: 32px;">
                        <td>{{i+1}}</td>
                        <td>{{phieu.hoVaTen}}</td>
                        <td>{{phieu.tenPhongBan}}</td>
                        <td>{{phieu.tinhTrangPhieu}}</td>
                        <td>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="5" style=" padding: 0;">
                            <div [id]="'faq' + i" class="accordion-collapse collapse"
                                [attr.data-bs-parent]="'#mainAccordion'">
                                <div class="accordion-body">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr class="table-active" style="line-height: 36px;">
                                                <th scope="col">Tên vật tư</th>
                                                <th scope="col">Mã vật tư</th>
                                                <th scope="col">Số lượng yêu cầu</th>
                                                <th scope="col">Số lượng tồn kho</th>
                                                <th scope="col">Tùy chọn</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let detail of detialPhieu;let i = index" class="table-info"
                                                style="line-height: 32px;">
                                                <td>{{detail.tenVatTu}}</td>
                                                <td>{{detail.maVatTu}}</td>
                                                <td>{{detail.soLuongYeuCau}}</td>
                                                <td>{{detail.soLuongTon}}</td>
                                                <ng-container *ngIf="detail.soLuongTon >= detail.soLuongYeuCau">
                                                    <td>
                                                        <button type="button" class="btn btn-success"><i
                                                                (click)="SubmitCap(detail)" 
                                                                class="bi bi-check-circle"></i>
                                                        </button>
                                                        <span> | </span>
                                                        <button type="button" class="btn btn-success">
                                                            <i (click)="SubmitAddMaVT(detail)" 
                                                                class="bi bi-qr-code"></i>
                                                        </button>

                                                    </td>
                                                </ng-container>
                                                <ng-container *ngIf="detail.soLuongTon < detail.soLuongYeuCau">
                                                    <td>
                                                        <button class="btn btn-success " data-bs-toggle="modal"
                                                            data-bs-target="#addVatTu"
                                                            (click)="SubmitMua(detail.idChiTietPhieu)">
                                                            <i class="bi bi-cart3"></i>
                                                        </button>
                                                    </td>
                                                </ng-container>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </td>
                    </tr>
                </ng-container>
            </tbody>
        </table>
    </div>


<div class="row" *ngIf="dsPhieu!=null">
    <pagination-controls class="pagination justify-content-center" style="padding-top: 14px;" previousLabel="Prev"
        nextLabel="Next" (pageChange)="onTableDataChange($event)">
    </pagination-controls>
</div>
<div class="modal fade" id="addVatTu" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-body" *ngIf="phieuMua">Yêu cầu mua: {{phieuMua.tenVatTu}}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                    (click)="ngOnInit()"></button>
            </div>
            <div class="modal-body">
                <app-yeu-cau-mua [VTMua]="phieuMua"></app-yeu-cau-mua>
            </div>
        </div>
    </div>
</div>